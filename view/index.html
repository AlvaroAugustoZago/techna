<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Socket.io</title>
  </head>

  <body>
    <div class="container">
      <div class="row">
        <div class="col">
          <div
            class="btn-group-vertical ml-4 mt-4 teclado"
            role="group"
            aria-label="Basic example"
          >
            <div class="btn-group">
              <input class="text-center form-control-lg mb-2" id="code" />
            </div>
            <div class="btn-group">
              <button
                type="button"
                class="btn btn-outline-secondary py-3 botao"
                onclick="document.getElementById('code').value=document.getElementById('code').value + '7';"
              >
                7
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary py-3 botao"
                onclick="document.getElementById('code').value=document.getElementById('code').value + '8';"
              >
                8
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary py-3 botao"
                onclick="document.getElementById('code').value=document.getElementById('code').value + '9';"
              >
                9
              </button>
            </div>
            <div class="btn-group">
              <button
                type="button"
                class="btn btn-outline-secondary py-3 botao"
                onclick="document.getElementById('code').value=document.getElementById('code').value + '4';"
              >
                4
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary py-3 botao"
                onclick="document.getElementById('code').value=document.getElementById('code').value + '5';"
              >
                5
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary py-3 botao"
                onclick="document.getElementById('code').value=document.getElementById('code').value + '6';"
              >
                6
              </button>
            </div>
            <div class="btn-group">
              <button
                type="button"
                class="btn btn-outline-secondary py-3 botao"
                onclick="document.getElementById('code').value=document.getElementById('code').value + '1';"
              >
                1
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary py-3 botao"
                onclick="document.getElementById('code').value=document.getElementById('code').value + '2';"
              >
                2
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary py-3 botao"
                onclick="document.getElementById('code').value=document.getElementById('code').value + '3';"
              >
                3
              </button>
            </div>
            <div class="btn-group">
              <button
                type="button"
                class="btn btn-outline-secondary py-3 botao"
                onclick="document.getElementById('code').value=document.getElementById('code').value + '0';"
              >
                0
              </button>
              <button
                type="button"
                class="btn btn-primary py-3 botao abrir"
                onclick=""
              >
                Abrir
              </button>
            </div>
          </div>
        </div>
        <div class="col">
          <div
            class="btn-group-vertical ml-4 mt-4 teclado"
            role="group"
          >
            <button
                type="button"
                class="btn btn-outline-secondary py-5 icone-menu"
                onclick="location.href='pages/estoque.html'"           
              >
                Estoque
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary py-5 icone-menu"
                onclick="location.href='pages/movimentacoes.html'"
              >
                Movimentações
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary py-5 icone-menu"
                onclick="location.href='pages/configuracao.html'" 
              >
                Configurações
              </button>
          </div>
        </div>
      </div>
    </div>


    
  
    <!-- <div class="scoreboard"></div> --> -->

    <script
      src="https://cdn.socket.io/4.3.2/socket.io.min.js"
      integrity="sha384-KAZ4DtjNhLChOB/hxXuKqhMLYvx3b5MlT55xPEiNmREKRzeEm+RVPlTnAn0ajQNs"
      crossorigin="anonymous"
    ></script>

    <!-- <script src="static/socket.io/client-dist/socket.io.js"></script> -->
    <script>
      const scoreDiv = document.querySelector('div.scoreboard');
      let tableHeaders = ['Tag', 'Antena', 'Rssi', 'Count'];
      const createAntena1Table = () => {
        while (scoreDiv.firstChild) scoreDiv.removeChild(scoreDiv.firstChild);
        let scoreboardTable = document.createElement('table');
        scoreboardTable.className = 'antena1Table';
        let scoreboardTableHead = document.createElement('thead');
        scoreboardTableHead.className = 'scoreboardTableHead';
        let scoreboardTableHeaderRow = document.createElement('tr');
        scoreboardTableHeaderRow.className = 'scoreboardTableHeaderRow';
        tableHeaders.forEach((header) => {
          let scoreHeader = document.createElement('th');
          scoreHeader.innerText = header;
          scoreboardTableHeaderRow.append(scoreHeader);
        });
        scoreboardTableHead.append(scoreboardTableHeaderRow);
        scoreboardTable.append(scoreboardTableHead);
        let scoreboardTableBody = document.createElement('tbody');
        scoreboardTableBody.className = 'scoreboardTable-Body';
        scoreboardTable.append(scoreboardTableBody);
        scoreDiv.append(scoreboardTable);
      };

      const appendAntena1 = (singleScore, singleScoreIndex) => {
        const scoreboardTable = document.querySelector('.antena1Table');
        let scoreboardTableBodyRow = document.createElement('tr');
        scoreboardTableBodyRow.className = 'scoreboardTableBodyRow';

        let usernameData = document.createElement('td');
        usernameData.innerText = singleScore.tag;
        let scoreData = document.createElement('td');
        scoreData.innerText = singleScore.antena;
        let timeData = document.createElement('td');
        timeData.innerText = singleScore.rssi;
        let accuracyData = document.createElement('td');
        accuracyData.innerText = singleScore.count;
        scoreboardTableBodyRow.append(
          usernameData,
          scoreData,
          timeData,
          accuracyData,
        );
        scoreboardTable.append(scoreboardTableBodyRow);
      };

      var socket = io('http://localhost:3000/view');

      socket.on('exibTags', (data) => {
        createAntena1Table();
        data.forEach(appendAntena1);
      });
      createAntena1Table();
      socket.on('exibTag', (tag) => {
        let oTable = document.querySelector('.antena1Table');
        let data = [...oTable.rows].map((t) =>
          [...t.children].map((u) => u.innerText),
        );

        const index = data.findIndex(
          (row) => row[0] === tag.tag && row[1] === tag.antena,
        );
        if (index === -1) appendAntena1(tag, data.length + 1);
        else {
          const tds = [...[...oTable.rows][index].children];
          tds[2].innerText = tag.rssi;
          tds[3].innerText = tag.count;
        }
      });

      socket.on('message', (data) => console.log(data));

      
    </script>
    <script src="./dist/renderer.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="./index.css" />
  </body>
</html>
