<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Socket.io</title>
  </head>

  <body>
    <div class="container">
      <div class="row">
        <div class="col">
          <div
            class="btn-group-vertical ml-4 mt-4 teclado"
            role="group"
            aria-label="Basic example"
          >
            <div class="btn-group">
              <input class="text-center form-control-lg mb-2" id="code" />
            </div>
            <div class="btn-group">
              <button
                type="button"
                class="btn btn-outline-secondary py-3 botao"
                onclick="document.getElementById('code').value=document.getElementById('code').value + '7';"
              >
                7
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary py-3 botao"
                onclick="document.getElementById('code').value=document.getElementById('code').value + '8';"
              >
                8
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary py-3 botao"
                onclick="document.getElementById('code').value=document.getElementById('code').value + '9';"
              >
                9
              </button>
            </div>
            <div class="btn-group">
              <button
                type="button"
                class="btn btn-outline-secondary py-3 botao"
                onclick="document.getElementById('code').value=document.getElementById('code').value + '4';"
              >
                4
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary py-3 botao"
                onclick="document.getElementById('code').value=document.getElementById('code').value + '5';"
              >
                5
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary py-3 botao"
                onclick="document.getElementById('code').value=document.getElementById('code').value + '6';"
              >
                6
              </button>
            </div>
            <div class="btn-group">
              <button
                type="button"
                class="btn btn-outline-secondary py-3 botao"
                onclick="document.getElementById('code').value=document.getElementById('code').value + '1';"
              >
                1
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary py-3 botao"
                onclick="document.getElementById('code').value=document.getElementById('code').value + '2';"
              >
                2
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary py-3 botao"
                onclick="document.getElementById('code').value=document.getElementById('code').value + '3';"
              >
                3
              </button>
            </div>
            <div class="btn-group">
              <button
                type="button"
                class="btn btn-outline-secondary py-3 botao"
                onclick="document.getElementById('code').value=document.getElementById('code').value + '0';"
              >
                0
              </button>
              <button
                type="button"
                class="btn btn-primary py-3 botao abrir"
                onclick="start()"
              >
                <!-- data-bs-toggle="modal"
                data-bs-target="#newInstallModal" -->
                Abrir
              </button>
            </div>
          </div>
        </div>
        <div class="col">
          <div class="btn-group-vertical ml-4 mt-4 teclado" role="group">
            <button
              type="button"
              class="btn btn-outline-secondary py-5 icone-menu"
              onclick="location.href='pages/estoque.html'"
            >
              Estoque
            </button>
            <button
              type="button"
              class="btn btn-outline-secondary py-5 icone-menu"
              onclick="location.href='pages/movimentacoes.html'"
            >
              Movimentações
            </button>
            <button
              type="button"
              class="btn btn-outline-secondary py-5 icone-menu"
              onclick="location.href='pages/configuracao.html'"
            >
              Configurações
            </button>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal"
      tabindex="-1"
      id="newInstallModal"
      aria-labelledby="settings"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Porta aberta</h5>
          </div>
          <div class="modal-body">
            <p>A Porta está aberta!</p>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" tabindex="-1" id="senhaInvalidaModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Senha invalida</h5>
          </div>
          <div class="modal-body">
            <p>Senha invalida! Digite novamente</p>
          </div>
        </div>
      </div>
    </div>

    <script
      src="https://cdn.socket.io/4.3.2/socket.io.min.js"
      integrity="sha384-KAZ4DtjNhLChOB/hxXuKqhMLYvx3b5MlT55xPEiNmREKRzeEm+RVPlTnAn0ajQNs"
      crossorigin="anonymous"
    ></script>
    <script src="./index.js"></script>
    <script src="./render.js"></script>

    <script src="./dist/renderer.js"></script>
    <script>
      var socket = io('http://localhost:3000/view');
      const { ipcRenderer } = require('electron');
      function start() {
        socket.emit('start', [document.getElementById('code').value]);
      }

      socket.on('authorized', (data) => {
        var myModal = new bootstrap.Modal(
          document.getElementById('newInstallModal'),
          { backdrop: 'static', keyboard: false },
        );
        myModal.show();
        ipcRenderer.send('GPIO', 'ON');
        ipcRenderer.invoke('wait-close-port').then((result) => {
          socket.emit('porta-fechada');
          myModal.toggle();
        });
      });
      socket.on('unauthorized', (data) => {
        var myModal = new bootstrap.Modal(
          document.getElementById('senhaInvalidaModal'),
          { backdrop: 'static', keyboard: false },
        );
        myModal.show();
        setTimeout(() => myModal.toggle(), 3000);
      });
      socket.on('message', (data) => console.log(data));
    </script>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="./index.css" />
  </body>
</html>
